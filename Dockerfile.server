# Backend Dockerfile (Node.js/Hono)
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install

# Copy source code
COPY server/ ./server/
COPY shared/ ./shared/
COPY tsconfig.json ./

# Create a production startup script
RUN echo '#!/bin/sh\ncd /app && npm run start:server' > /app/start.sh && \
    chmod +x /app/start.sh

EXPOSE 4000

CMD ["/app/start.sh"]